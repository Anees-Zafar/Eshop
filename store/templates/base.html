<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block title %}Store{% endblock %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    {% load cart %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 10000; /* Ensure it's above other elements */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        /* Spinner Wrapper */
        .spinner-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        /* Spinner */
        .spinner-border {
            width: 4rem;
            height: 4rem;
            border-width: 0.5rem;
            color: #3498db;
        }
        
        /* Hiding the overlay */
        .hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* Optional: Make the entire page transition smoothly */
        * {
            transition-duration: 0s;
        }


    </style>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .banner h1, .banner p {
            color: white;
            margin-bottom: 20px;
        }
        
        .collection-item img {
            max-height: 200px;
        }
        
        .collection-item h5 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .category-section h4 {
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .card-title, .card-text {
            color: black;
        }
        
        .accordion-button {
            font-weight: 600;
        }
        
        footer p {
            margin: 0;
            font-size: 0.9rem;
        }
        
        footer a {
            text-decoration: underline;
        }
        #loadingOverlay1 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 10000; /* Ensure it's above other elements */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Spinner Wrapper */
        .spinner-wrapper1 {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        /* Optional: Customize the spinner */
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.4rem;
        }
    </style>
</head>
<body>

     {% comment %} loading spinner start {% endcomment %}

  <div id="loadingOverlay1" style="display: none;">
    <div class="spinner-wrapper1">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only"></span>
        </div>
    </div>
</div>

  {% comment %} loading spinner end {% endcomment %}


    <!-- full page Preloader HTML -->
    <div id="loadingOverlay">
        <div class="spinner-wrapper">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only"></span>
            </div>
        </div>
    </div>

    {% comment %} full page preloader ends {% endcomment %}


    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <!-- Logo -->
            <a class="navbar-brand" href="{% url 'index' %}">
                
                {% comment %} <img src="{% static 'your-logo-path/logo.png' %}" alt="Logo" width="40" height="40" class="d-inline-block align-text-top"> {% endcomment %}
                <b>
                E-Commerce
            </b>
            </a>

            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar Links -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'index' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'male' %}">Male</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'female' %}">Female</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'kid' %}">Kids</a>
                    </li>
                    {% if request.session.customer_id %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'todo' %}">TODOS</a>
                    </li>
                    {% endif %}
                   
                </ul>
                
                <!-- Cart & User Account Links -->
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                     <a class="nav-link" href="{% url 'cart' %}">
                            <i class="bi bi-cart-fill"></i> Cart
                            <span class="badge bg-primary">{{ request.session.cart|cart_total_quantity }}</span>
                        </a>
                        {% comment %} <a href="{% url 'cart' %}">Cart (<span id="cart-total">0</span>)</a> {% endcomment %}
                    </li>

                    {% if request.session.customer_id %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'orders' %}">Orders</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'signup' %}">Signup</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock %}


    <script>
        // Wait until the entire page is loaded
        window.addEventListener('load', function () {
            // Get the preloader element by its ID
            var preloader = document.getElementById('loadingOverlay');
            
            // Add a fade-out effect
            preloader.style.transition = 'opacity 0.5s ease, visibility 0.5s ease';
            preloader.classList.add('hidden'); // Add the hidden class to hide the preloader
            
            // Optional: You can completely remove the preloader from the DOM after the transition
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 500);  // Match the duration with the transition time (0.5s)
        });
    </script>
    {% comment %} <script>
        function updateCart(productId, action) {
            const url = '/update_cart/';
            const data = {
                product: productId,
                action: action
            };
        
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update parts of the frontend without a reload
                    updateFrontend(data);  // Function to update the DOM
                }
            })
            .catch(error => console.log('Error:', error));
        }
        
        // Helper function for CSRF token (Django specific)
        function getCSRFToken() {
            let csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            return csrfToken;
        }



        function updateFrontend(data) {
            const cart = data.cart;
        
            // Example: Update the cart quantity on the page
            for (let productId in cart) {
                const quantityElement = document.querySelector(`#product-quantity-${productId}`);
                if (quantityElement) {
                    quantityElement.textContent = cart[productId];  // Update quantity in the UI
                }
            }
        
            // Example: Update total cart quantity in the header
            const totalQuantity = Object.values(cart).reduce((total, num) => total + num, 0);
            document.querySelector('#cart-total').textContent = totalQuantity;
        
            // Optionally: Show a toast notification or feedback message
            showSuccessMessage('Cart updated successfully!');
        }
        
        // Optional: Show a success message to the user
        function showSuccessMessage(message) {
            const messageElement = document.querySelector('#success-message');
            messageElement.textContent = message;
            messageElement.style.display = 'block';  // Display success message
            setTimeout(() => {
                messageElement.style.display = 'none';  // Hide after 3 seconds
            }, 3000);
        }
        
    </script> {% endcomment %}

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
